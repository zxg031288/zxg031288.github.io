/workspace/-$ /bin/bash -lc nl -ba index.html
1	<!doctype html>
     2	<html lang="zh-CN">
     3	<head>
     4	  <meta charset="utf-8" />
     5	  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
     6	  <title>新年快乐</title>
     7	  <style>
     8	    html,body{margin:0;height:100%;background:#05060a;overflow:hidden}
     9	    canvas{display:block;width:100vw;height:100vh}
    10	  </style>
    11	</head>
    12	<body>
    13	  <audio id="bgm" src="新年快乐.mp3" loop preload="auto"></audio>
    14	  <canvas id="c"></canvas>
    15	
    16	<script>
    17	(() => {
    18	  const canvas = document.getElementById('c');
    19	  const ctx = canvas.getContext('2d');
    20	
    21	  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    22	  function resize(){
    23	    canvas.width = Math.floor(innerWidth * dpr);
    24	    canvas.height = Math.floor(innerHeight * dpr);
    25	    canvas.style.width = innerWidth + 'px';
    26	    canvas.style.height = innerHeight + 'px';
    27	    ctx.setTransform(dpr,0,0,dpr,0,0);
    28	  }
    29	  addEventListener('resize', resize, {passive:true});
    30	  resize();
    31	
    32	  // 音乐：首次点击触发
    33	  const bgm = document.getElementById('bgm');
    34	  let musicStarted = false;
    35	  async function startMusicIfNeeded(){
    36	    if (musicStarted) return;
    37	    try {
    38	      await bgm.play();
    39	      musicStarted = true;
    40	    } catch (e){
    41	    }
    42	  }
    43	
    44	  // 物理参数
    45	  const gravity = 0.12;
    46	  const rockets = [];
    47	  const sparks = [];
    48	
    49	  const rand = (a,b)=>a+Math.random()*(b-a);
    50	  const hsl = (h,s,l,a=1)=>`hsla(${h},${s}%,${l}%,${a})`;
    51	
    52	  function launchRocket(targetX, targetY){
    53	    // 从底部发射，朝目标附近飞（但不是直线瞬移）
    54	    const x0 = targetX;
    55	    const y0 = innerHeight + 10;
    56	    const apexY = Math.max(60, Math.min(innerHeight*0.55, targetY)); // 爆点高度受点击位置影响
    57	    const hue = rand(0,360);
    58	
    59	    // 初速度：让它向上飞，略带横向偏移
    60	    const vy0 = -rand(10.5, 13.5);
    61	    const vx0 = rand(-1.2, 1.2);
    62	
    63	    rockets.push({
    64	      x: x0, y: y0,
    65	      vx: vx0, vy: vy0,
    66	      hue,
    67	      apexY,
    68	      trail: [],
    69	      exploded: false
    70	    });
    71	  }
    72	
    73	  function explode(x, y, hue){
    74	    const count = Math.floor(rand(70, 120));
    75	    for(let i=0;i<count;i++){
    76	      const ang = Math.random()*Math.PI*2;
    77	      const sp = rand(1.5, 5.8);
    78	      sparks.push({
    79	        x, y,
    80	        vx: Math.cos(ang)*sp,
    81	        vy: Math.sin(ang)*sp,
    82	        life: 0,
    83	        ttl: rand(55, 95),
    84	        hue: hue + rand(-18, 18),
    85	        size: rand(1.1, 2.6)
    86	      });
    87	    }
    88	  }
    89	
    90	  function fadeBackground(){
    91	    ctx.fillStyle = 'rgba(5,6,10,0.18)'; // 拖影
    92	    ctx.fillRect(0,0,innerWidth,innerHeight);
    93	  }
    94	
    95	  function step(){
    96	    fadeBackground();
    97	
    98	    // rockets：上升 + 顶点爆炸
    99	    for(let i=rockets.length-1;i>=0;i--){
   100	      const r = rockets[i];
   101	
   102	      // trail
   103	      r.trail.push({x:r.x, y:r.y});
   104	      if(r.trail.length > 14) r.trail.shift();
   105	
   106	      // move
   107	      r.x += r.vx;
   108	      r.y += r.vy;
   109	      r.vy += gravity * 0.25;
   110	
   111	      // draw trail
   112	      for(let t=0;t<r.trail.length;t++){
   113	        const p = r.trail[t];
   114	        const a = (t+1)/r.trail.length;
   115	        ctx.beginPath();
   116	        ctx.fillStyle = hsl(r.hue, 100, 70, 0.15 + 0.45*a);
   117	        ctx.arc(p.x, p.y, 1.0 + 1.2*a, 0, Math.PI*2);
   118	        ctx.fill();
   119	      }
   120	
   121	      // draw head
   122	      ctx.beginPath();
   123	      ctx.fillStyle = hsl(r.hue, 100, 75, 0.95);
   124	      ctx.arc(r.x, r.y, 2.3, 0, Math.PI*2);
   125	      ctx.fill();
   126	
   127	      // 到达顶点：y 小于 apexY 或者上升速度接近 0
   128	      if(!r.exploded && (r.y <= r.apexY || r.vy > -0.8)){
   129	        r.exploded = true;
   130	        explode(r.x, r.y, r.hue);rockets.splice(i,1);
   131	      }
   132	
   133	      // 飞出屏幕也回收
   134	      if(r.y < -50 || r.x < -50 || r.x > innerWidth+50){
   135	        rockets.splice(i,1);
   136	      }
   137	    }
   138	
   139	    // sparks：爆炸粒子
   140	    for(let i=sparks.length-1;i>=0;i--){
   141	      const p = sparks[i];
   142	      p.life += 1;
   143	      p.x += p.vx;
   144	      p.y += p.vy;
   145	      p.vy += gravity;
   146	      p.vx *= 0.985;
   147	      p.vy *= 0.985;
   148	
   149	      const t = 1 - p.life/p.ttl;
   150	      if(t <= 0){
   151	        sparks.splice(i,1);
   152	        continue;
   153	      }
   154	      ctx.beginPath();
   155	      ctx.fillStyle = hsl(p.hue, 100, 65, Math.max(0, t));
   156	      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
   157	      ctx.fill();
   158	    }
   159	
   160	    requestAnimationFrame(step);
   161	  }
   162	  requestAnimationFrame(step);
   163	
   164	  function onPointer(e){
   165	    startMusicIfNeeded();
   166	    const rect = canvas.getBoundingClientRect();
   167	    const clientX = e.clientX ?? (e.touches && e.touches[0].clientX);
   168	    const clientY = e.clientY ?? (e.touches && e.touches[0].clientY);
   169	    const x = clientX - rect.left;
   170	    const y = clientY - rect.top;
   171	
   172	    // 点击一次就发射一次
   173	    launchRocket(x, y);
   174	  }
   175	
   176	  addEventListener('click', onPointer, {passive:true});
   177	  addEventListener('touchstart', (e)=>onPointer(e), {passive:true});
   178	})();
   179	</script>
   180	</body>
   181	</html>
